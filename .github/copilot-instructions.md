# Meeplit AI Guide

- **Architecture**: Bun workspace with server, client, and shared packages. Server runs Hono REST + socket.io reverse RPC on Bun engine; client is Vue 3 + Vite; shared defines RPC and Card types.
- **Auth & Sessions**: Login via POST /api/login with name/password; stores sessionId returned and send as x-session-id for HTTP and socket auth. Seed users (alice/bob/charlie/1/2/3 with password same as name or digits) live in SQLite created by AccountStore. See [packages/server/src/AccountStore.ts](packages/server/src/AccountStore.ts).
- **Room lifecycle**: Create/list/join/ready endpoints in [packages/server/src/main.ts](packages/server/src/main.ts). PlayerManager assigns sessionId/playerId; RoomManager handles seats, ready states, and transitions waiting→playing. All-ready triggers startRoomGame stub (per-room loop hook).
- **Reverse RPC pattern**: Server obtains per-player RemoteClient from Player.bindSocket and calls client methods (setGameInfo, addChatMessage, updateCard, ask, playCard, etc.). RPC plumbing lives in [packages/server/src/playerClient.ts](packages/server/src/playerClient.ts) and [packages/shared/rpc.ts](packages/shared/rpc.ts); batch calls via RPC_BATCH_METHOD_NAME support sequential/parallel.
- **Client RPC exposure**: Game.vue connects socket with sessionId and exposes GameService instance so server can call into the client. GameService methods mutate reactive game state and delegate to Ask/Player component refs. See [packages/client/src/game/Game.vue](packages/client/src/game/Game.vue) and [packages/client/src/game/GameService.ts](packages/client/src/game/GameService.ts).
- **Client state layout**: Main entry chooses phase auth→lobby→play, keeps session in localStorage, and drives HTTP calls for rooms. Game layout uses slots in [packages/client/src/game/views/Layout.vue](packages/client/src/game/views/Layout.vue) with Ask/Board/Player/Opponent/Chat panels; state is provided via GameStateKey and injected by subviews.
- **Chat flow**: Client emits chat text through socket "chat" event; server broadcasts system/player messages to all clients in room and pushes via addChatMessage RPC to display.
- **Cards & revivable data**: Shared Card base uses @Revivable metadata to rehydrate across RPC. When sending class instances, wrap payloads with markRevivablePayload (RemoteClient does this). Define new cards in [packages/server/src/game](packages/server/src/game) and export via index.ts.
- **Environment config**: .env consumes VITE_WS_HOST/PORT/CLIENT_ORIGIN in [packages/server/src/env.ts](packages/server/src/env.ts); same host/port read in client Main.vue for HTTP/WS URLs.
- **Dev workflows**: Install with bun. Run server watcher `bun run s` from repo root (Bun.serve + Hono + socket.io). Run client dev `bunx --bun vite --config packages/client/vite.config.ts` or `cd packages/client && bun run dev`. Root `bun run c` uses same vite config. Tests currently limited; sample Bun tests under packages/server/test/*. Ensure Bun runtime available.
- **UI scaling**: main.ts applies JS-driven scale to 1440x810 base canvas; avoid breaking `#app > *` transform origin. Tailwind v4 with typography plugin used via @import in main.css.
- **Cross-package imports**: Use workspace aliases @meeplit/client and @meeplit/shared; Vue uses @ alias (src) configured in Vite/tsconfig.
- **Extending gameplay**: Implement per-room loop in startRoomGame (deal cards, drive turns) and use RemoteClient.emitBatch/callBatch for orchestrated animations. Maintain RoomManager readiness flags and player seats when kicking/rejoining.
- **Caveats**: socket disconnect triggers cleanupOnDisconnect; ensure seat removal and ready reset handled when extending. Reverse RPC "call" requires timeout; provide defaultResult for resilience.
